USE master
GO

IF DB_ID('QLDOIBONG') IS NOT NULL
	DROP DATABASE QLDOIBONG
GO

CREATE DATABASE QLDOIBONG
GO

USE QLDOIBONG
GO

CREATE TABLE DOI (
	IDDOI INT,
	TENDOI NVARCHAR(50),
	DOITRUONG INT,
	SOLUONG INT

	CONSTRAINT PK_DOI
	PRIMARY KEY(IDDOI)
)

CREATE TABLE BOTRI (
	IDDOI INT,
	IDTHANHVIEN INT,
	DIACHI NVARCHAR(100),
	NHIEMVU NVARCHAR(100),
	QUANLI INT

	CONSTRAINT PK_BOTRI
	PRIMARY KEY(IDDOI, IDTHANHVIEN)
)

CREATE TABLE THANHVIEN (
	IDTHANHVIEN INT,
	HOTEN NVARCHAR(50),
	SOCMND CHAR(10),
	DIACHI NVARCHAR(100),
	NGAYSINH DATE

	CONSTRAINT PK_THANHVIEN
	PRIMARY KEY(IDTHANHVIEN)
)

ALTER TABLE BOTRI
ADD
	CONSTRAINT FK_BOTRI_DOI 
	FOREIGN KEY(IDDOI) 
	REFERENCES DOI,

	CONSTRAINT FK_BOTRI_THANHVIEN_TV 
	FOREIGN KEY(IDTHANHVIEN)
	REFERENCES THANHVIEN,

	CONSTRAINT FK_BOTRI_THANHVIEN_QL
	FOREIGN KEY(QUANLI)
	REFERENCES THANHVIEN

ALTER TABLE DOI
ADD
	CONSTRAINT FK_DOI_THANHVIEN
	FOREIGN KEY(DOITRUONG)
	REFERENCES THANHVIEN

SET DATEFORMAT DMY
GO

INSERT THANHVIEN(IDTHANHVIEN, HOTEN, SOCMND, DIACHI, NGAYSINH)
VALUES(1, N'Nguyễn Quan Tùng', '240674018', N'TPHCM', '30/1/2000'),
	(2, N'Lưu Phi Nam', '240674027', N'Quảng Nam', '12/3/2001'),
	(3, N'Lê Quang Bảo', '240674063', N'Quảng Ngãi', '14/5/1999'),
	(4, N'Hà Ngọc Thúy', '240674504', N'TPHCM', '26/7/1998'),
	(5, N'Trương Thị Minh', '240674405', N'Hà Nội', Null),
	(6, N'Ngô Thị Thủy', '240674306', null, '18/9/2000')
SELECT* FROM THANHVIEN

INSERT DOI(IDDOI, TENDOI, DOITRUONG)
VALUES(2, N'Đôi Tân Phú', 1),
	(7, N'Đội Bình Phú', 5)
SELECT* FROM DOI

INSERT BOTRI(IDDOI, IDTHANHVIEN, DIACHI, NHIEMVU, QUANLI)
VALUES(2, 2, N'123 Vườn Lài Tân Phú', N'Trực khu vực vòng xoay 1', 1),
	(2, 1, N'45 Phú Thọ Hòa Tân Phú', N'Theo dõi hoạt động', 1),
	(7, 3, N'11 Chợ lớn Bình Phú', null, 5),
	(7, 4, N'2 Bis Nguyễn Văn Cừ Q5', Null, 3),
	(7, 5, N'1Bis Trần Đình Xu Q1', Null, Null)
SELECT* FROM BOTRI
